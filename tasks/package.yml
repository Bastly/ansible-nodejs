---
# tasks file for roles/bastly.nodejs
- name: nodejs | Make sure the dependencies are installed
  sudo: yes
  apt: pkg={{ item }}
  with_items:
    - git

- name: Ensure Ubuntu Distro is Supported
  get_url: 
    url='https://deb.nodesource.com/node/dists/{{ ansible_distribution_release }}/Release' 
    dest=/dev/null
  register: distrosupported

- name: Add Nodesource Keys
  shell: wget -qO - https://deb.nodesource.com/gpgkey/nodesource.gpg.key  | sudo apt-key add -

- name: Add Nodesource Apt Sources List Deb
  shell: sudo add-apt-repository "deb https://deb.nodesource.com/node {{ ansible_distribution_release }} main"

- name: Add Nodesource Apt Sources List Deb Src
  shell: sudo add-apt-repository "deb-src https://deb.nodesource.com/node {{ ansible_distribution_release }} main"

- name: Install NodeJS
  apt: name=nodejs={{ nodejs_version }}* update_cache=true
  when: distrosupported|success

- name: nodejs | debug version name
  debug: msg="{{ nodejs_version }}*"
